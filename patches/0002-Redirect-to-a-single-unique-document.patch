From b13b28bb0c20bdffa3ac45a14568d8f90cbdeeff Mon Sep 17 00:00:00 2001
From: Ian Denhardt <ian@zenhack.net>
Date: Wed, 6 Oct 2021 20:41:44 -0400
Subject: [PATCH 2/4] Redirect / to a single unique document.

---
 lib/response.js | 14 ++++++++++++++
 1 file changed, 14 insertions(+)

diff --git a/lib/response.js b/lib/response.js
index 44696a55..d0fa2ce1 100644
--- a/lib/response.js
+++ b/lib/response.js
@@ -19,6 +19,20 @@ const response = {
 }
 
 function showIndex (req, res, next) {
+  // Sandstorm edit: redirect to a single note. Create a new
+  // one if one does not already exist.
+  models.Note.findOne({}).then((note) => {
+    let loc = '/new';
+    if(note) {
+      console.log(note)
+      loc = note.dataValues.shortid;
+    }
+    console.log("Location: ", loc);
+    res.writeHead(301, {'Location': loc})
+    res.end();
+  });
+  return;
+
   const authStatus = req.isAuthenticated()
   const deleteToken = ''
 
-- 
2.33.1

